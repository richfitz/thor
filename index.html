<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interface to LMDB • thor</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Interface to LMDB">
<meta property="og:description" content='Key-value store, implemented as a wrapper around LMDB;
    the "lightning memory-mapped database" &lt;https://www.symas.com/lmdb&gt;.
    LMDB is a transactional key value store that uses a memory map
    for efficient access.  This package wraps the entire LMDB
    interface (except duplicated keys), and provides objects for
    transactions and cursors.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">thor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/thor.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/richfitz/thor/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="thor">thor<a class="anchor" aria-label="anchor" href="#thor"></a>
</h1></div>
<!-- badges: start -->

<p>An R interface to <a href="https://github.com/LMDB/lmdb" class="external-link">LMDB</a>. LMDB is an embedded transactional key-value store and this package provides R mappings to it. It wraps the entire LMDB interface, except for support for duplicated keys.</p>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<p>The package comes with a vignette that describes the main features of the package and of LMDB - see <a href="https://richfitz.github.io/thor/articles/thor.html" class="external-link">here</a> for a version online. The package also has reference documentation for all methods. It may be useful to refer to the <a href="http://lmdb.tech/doc" class="external-link">LMDB documentation</a> along side the reference documentation for some details (but hopefully not too much).</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>Everything starts by creating an environment (which lives at a point in the file system), and then using methods of the environment object to interact with the database</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu">thor</span><span class="fu">::</span><span class="fu"><a href="reference/mdb_env.html">mdb_env</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">env</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;mdb_env&gt;</span></span>
<span><span class="co">##   Informational:</span></span>
<span><span class="co">##     path()</span></span>
<span><span class="co">##     flags()</span></span>
<span><span class="co">##     info()</span></span>
<span><span class="co">##     stat()</span></span>
<span><span class="co">##     maxkeysize()</span></span>
<span><span class="co">##     maxreaders()</span></span>
<span><span class="co">##   Transactions:</span></span>
<span><span class="co">##     begin(db = NULL, write = FALSE, sync = NULL, metasync =  ...</span></span>
<span><span class="co">##     with_transaction(fun, db = NULL, write = FALSE)</span></span>
<span><span class="co">##   Databases:</span></span>
<span><span class="co">##     open_database(key = NULL, reversekey = FALSE, create = TRUE)</span></span>
<span><span class="co">##     drop_database(db, delete = TRUE)</span></span>
<span><span class="co">##   Management:</span></span>
<span><span class="co">##     sync(force = FALSE)</span></span>
<span><span class="co">##     copy(path, compact = FALSE)</span></span>
<span><span class="co">##     close()</span></span>
<span><span class="co">##     destroy()</span></span>
<span><span class="co">##     reader_list()</span></span>
<span><span class="co">##     reader_check()</span></span>
<span><span class="co">##   Helpers:</span></span>
<span><span class="co">##     get(key, missing_is_error = TRUE, as_raw = NULL, db = NULL)</span></span>
<span><span class="co">##     put(key, value, overwrite = TRUE, append = FALSE, db = NULL)</span></span>
<span><span class="co">##     del(key, db = NULL)</span></span>
<span><span class="co">##     exists(key, db = NULL)</span></span>
<span><span class="co">##     list(starts_with = NULL, as_raw = FALSE, size = NULL, db ...</span></span>
<span><span class="co">##     mget(key, as_raw = NULL, db = NULL)</span></span>
<span><span class="co">##     mput(key, value, overwrite = TRUE, append = FALSE, db =  ...</span></span>
<span><span class="co">##     mdel(key, db = NULL)</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">put</span><span class="op">(</span><span class="st">"hello"</span>, <span class="st">"world"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">exists</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span> <span class="co"># world</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "world"</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">del</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>LMDB is <em>transactional</em>, and <code>thor</code> exposes this like so:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span> <span class="op">&lt;-</span> <span class="va">env</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span>write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">txn</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;mdb_txn&gt;</span></span>
<span><span class="co">##   Informational:</span></span>
<span><span class="co">##     id()</span></span>
<span><span class="co">##     stat()</span></span>
<span><span class="co">##   Finish:</span></span>
<span><span class="co">##     commit()</span></span>
<span><span class="co">##     abort(cache = TRUE)</span></span>
<span><span class="co">##   Cursors:</span></span>
<span><span class="co">##     cursor()</span></span>
<span><span class="co">##   Data:</span></span>
<span><span class="co">##     get(key, missing_is_error = TRUE, as_proxy = FALSE, as_r ...</span></span>
<span><span class="co">##     put(key, value, overwrite = TRUE, append = FALSE)</span></span>
<span><span class="co">##     del(key)</span></span>
<span><span class="co">##     exists(key)</span></span>
<span><span class="co">##     list(starts_with = NULL, as_raw = FALSE, size = NULL)</span></span>
<span><span class="co">##     mget(key, as_proxy = FALSE, as_raw = NULL)</span></span>
<span><span class="co">##     mput(key, value, overwrite = TRUE, append = FALSE)</span></span>
<span><span class="co">##     mdel(key)</span></span>
<span><span class="co">##     replace(key, value, as_raw = NULL)</span></span>
<span><span class="co">##     pop(key, as_raw = NULL)</span></span>
<span><span class="co">##   Compare:</span></span>
<span><span class="co">##     cmp(a, b)</span></span></code></pre>
<p>Only one write transaction is active at a given point in time. There can be an unlimited number of read transactions.</p>
<pre><code><span><span class="va">txn</span><span class="op">$</span><span class="fu">put</span><span class="op">(</span><span class="st">"key"</span>, <span class="st">"value"</span><span class="op">)</span></span>
<span><span class="va">env</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"key"</span>, missing_is_error <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># NULL - not committed yet</span></span>
<span><span class="va">txn</span><span class="op">$</span><span class="fu">commit</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">env</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"key"</span><span class="op">)</span> <span class="co"># new transactions see the value</span></span></code></pre>
<p>There is a cursor interface for advanced features (see the vignette). Both keys and values can be strings or binary value, the latter working well with <code>serialize</code>. For efficient use from R, <code>thor</code> extends the LMDB interface to implement bulk reads, writes and deletes (<code>mget</code>, <code>mput</code> and <code>mdel</code>).</p>
</div>
<div class="section level2">
<h2 id="performance">Performance<a class="anchor" aria-label="anchor" href="#performance"></a>
</h2>
<p>lmdb is an extremely fast database, but this package may be much less fast than the underlying library. In order to make the interface safe to use from R, there is quite a bit of error checking, and the length of time involved in calling methods in R6 objects is orders of magnitude slower than performing an action on an lmdb database (this is not R6’s fault and primarily caused by the cost of S3 method lookup for <code>$</code> on an object with a class attribute). The vectorised functions will help here (e.g., <code>mget</code>, <code>mput</code>), so prefer these where practical if speed is a concern.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install from CRAN with</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"thor"</span><span class="op">)</span></span></code></pre></div>
<p>If you want to try the development version from github, you can install with</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"richfitz/thor"</span>, upgrade <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT + file LICENSE © <a href="https://github.com/richfitz" class="external-link">Rich FitzJohn</a>. The package contains included code from lmdb which it itself under the “OpenLDAP Public License” - see <a href="inst/LICENSE.lmdb"><code>inst/LICENSE.lmdb</code></a> for details</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=thor" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/richfitz/thor/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/richfitz/thor/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing thor</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Rich FitzJohn <br><small class="roles"> Author, maintainer </small>  </li>
<li>Howard Chu <br><small class="roles"> Author, copyright holder </small>  </li>
<li>Martin Hedenfalk <br><small class="roles"> Author, copyright holder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/" class="external-link"><img src="http://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a></li>
<li><a href="https://github.com/richfitz/thor/actions" class="external-link"><img src="https://github.com/richfitz/thor/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/github/richfitz/thor?branch=master" class="external-link"><img src="https://codecov.io/github/richfitz/thor/coverage.svg?branch=master" alt="codecov.io"></a></li>
<li><a href="https://cran.r-project.org/package=thor" class="external-link"><img src="http://www.r-pkg.org/badges/version/thor"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Rich FitzJohn, Howard Chu, Martin Hedenfalk.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
