<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>thor • thor</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="thor">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">thor</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/thor.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/richfitz/thor/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>thor</h1>
                        <h4 data-toc-skip class="author">Rich
FitzJohn</h4>
            
            <h4 data-toc-skip class="date">2025-06-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/richfitz/thor/blob/main/vignettes/thor.Rmd" class="external-link"><code>vignettes/thor.Rmd</code></a></small>
      <div class="d-none name"><code>thor.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>thor</code> provides an wrapper around LMDB; the lightning
memory-mapped database. This is an embedded key-value store; there is no
server (like SQLite) - the database exists purely on disk and uses file
locking to manage concurrent access between processes.</p>
<p>Key-value stores are simple systems for persistently storing values
against keys. In the case of <code>thor</code>, both the keys and the
data can be strings or (raw) data. This provides a low-level building
block on which other applications can be built. The complications come
from trying to efficiently query the store, or patterns like “add a new
value but only if the previous value was <code>foo</code>”.</p>
<p>This package does not provide a faithful 1:1 mapping of the
underlying LMDB C API because that requires too much care at the R level
not to crash R! Instead, probably at the cost of some performance,
<code>thor</code> provides a set of wrappers that try to prevent crashes
by invalidating objects in the correct order. The approach taken in is
very similar to the <a href="https://github.com/jnwatson/py-lmdb" class="external-link">python
interface to LMDB; <code>py-lmdb</code></a>.</p>
<p>Because the whole point of interacting with a database is side
effects, <code>thor</code> uses <a href="https://cran.r-project.org/package=R6" class="external-link">R6</a> for the interface.
This has the unfortunate effect of complicating the documentation
somewhat because R’s documentation is focussed heavily on
<em>functions</em> and the package provides only one function
(<code><a href="../reference/mdb_env.html">thor::mdb_env</a></code>) with everything else happening through
<em>methods</em> of this object, and the objects that it creates.</p>
<p><code>thor</code> tries to expose the underlying LMDB interface in a
nested set of objects of increasing power (and complexity). The objects
that the package provides are</p>
<ul>
<li><p><code>mdb_env</code>: the environment object, which is the
interface to the database file. Everything starts here!</p></li>
<li><p><code>mdb_dbi</code>: a database handle. Multiple databases may
be stored within a single environment and if more than one is used then
this object is passed about to control which database things
affect.</p></li>
<li><p><code>mdb_txn</code>: a transaction object. LMDB is a
<em>transactional</em> database and this object is used to carry out
actions within a transaction (such as getting and putting
data).</p></li>
<li><p><code>mdb_cursor</code>: a cursor. To go beyond basic
<code>get</code>/<code>put</code>, cursors<em> </em>are required. These
can be used to iterate through the ## *database, and to find
entries.</p></li>
<li><p><code>mdb_proxy</code>: a proxy for a result. This is used to
defer copying data from the database into R for as long as possible.
It’s a bit of an experiment so we’ll see how useful it turns out to
be.</p></li>
</ul>
<p>All of these objects have their own help pages, even though only
<code>mdb_env</code> has an actual function. On those help pages every
public function described (this is the same set that is printed when
displaying the objects). There are other functions that can be reached
using <code>$</code> - functions beginning with a <code>.</code> should
be considered <strong>private</strong>; using these can crash R. Other
functions (such as <code>format</code>) exist because of the way thor
uses R6.</p>
<p>For basic operations, one can just use the <code>mdb_env</code>
object and ignore the rest of the package. To do more interesting
things, you’ll need transactions (<code>mdb_txn</code>), and then
perhaps you’ll need cursors (<code>mdb_cursor</code>). The proxy objects
are available if you use transactions.</p>
</div>
<div class="section level2">
<h2 id="the-environment">The environment<a class="anchor" aria-label="anchor" href="#the-environment"></a>
</h2>
<p>The first step is to create an “environment”; this holds one or more
“databases” (though in the most simple case you can forget that detail
and just treat the environment as a database).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu">thor</span><span class="fu">::</span><span class="fu"><a href="../reference/mdb_env.html">mdb_env</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The first argument to <code><a href="../reference/mdb_env.html">thor::mdb_env</a></code> is the filename -
this is a directory where the database files will be kept. Here I am
using a temporary file for the database.</p>
<p>As an R6 object, the database environment has a number of methods
that can be used to perform actions on the database. The print method
groups these by theme:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;mdb_env&gt;</span></span>
<span><span class="co">##   Informational:</span></span>
<span><span class="co">##     path()</span></span>
<span><span class="co">##     flags()</span></span>
<span><span class="co">##     info()</span></span>
<span><span class="co">##     stat()</span></span>
<span><span class="co">##     maxkeysize()</span></span>
<span><span class="co">##     maxreaders()</span></span>
<span><span class="co">##   Transactions:</span></span>
<span><span class="co">##     begin(db = NULL, write = FALSE, sync = NULL, metasync =  ...</span></span>
<span><span class="co">##     with_transaction(fun, db = NULL, write = FALSE)</span></span>
<span><span class="co">##   Databases:</span></span>
<span><span class="co">##     open_database(key = NULL, reversekey = FALSE, create = TRUE)</span></span>
<span><span class="co">##     drop_database(db, delete = TRUE)</span></span>
<span><span class="co">##   Management:</span></span>
<span><span class="co">##     sync(force = FALSE)</span></span>
<span><span class="co">##     copy(path, compact = FALSE)</span></span>
<span><span class="co">##     close()</span></span>
<span><span class="co">##     destroy()</span></span>
<span><span class="co">##     reader_list()</span></span>
<span><span class="co">##     reader_check()</span></span>
<span><span class="co">##   Helpers:</span></span>
<span><span class="co">##     get(key, missing_is_error = TRUE, as_raw = NULL, db = NULL)</span></span>
<span><span class="co">##     put(key, value, overwrite = TRUE, append = FALSE, db = NULL)</span></span>
<span><span class="co">##     del(key, db = NULL)</span></span>
<span><span class="co">##     exists(key, db = NULL)</span></span>
<span><span class="co">##     list(starts_with = NULL, as_raw = FALSE, size = NULL, db ...</span></span>
<span><span class="co">##     mget(key, as_raw = NULL, db = NULL)</span></span>
<span><span class="co">##     mput(key, value, overwrite = TRUE, append = FALSE, db =  ...</span></span>
<span><span class="co">##     mdel(key, db = NULL)</span></span></code></pre>
<p>The last group <code>Helpers</code> are wrappers that let you ignore
the transactional nature of LMDB if you just want to do really simple
things.</p>
<p>The database is currently empty:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## character(0)</span></span></code></pre>
<p>But we can add some data to it:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">env</span><span class="op">$</span><span class="fu">put</span><span class="op">(</span><span class="fu">ids</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ids/man/adjective_animal.html" class="external-link">adjective_animal</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          <span class="fu">ids</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ids/man/random_id.html" class="external-link">random_id</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now there are 10 <em>keys</em> in the database, each holding a
value:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keys</span> <span class="op">&lt;-</span> <span class="va">env</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">keys</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "careful_gaur"                    "necessary_hen"                  </span></span>
<span><span class="co">##  [3] "preagricultural_icterinewarbler" "rhombohedral_walrus"            </span></span>
<span><span class="co">##  [5] "uninspirable_muntjac"            "unterrestrial_oryx"             </span></span>
<span><span class="co">##  [7] "upstanding_vixen"                "waiting_xiaosaurus"             </span></span>
<span><span class="co">##  [9] "wet_pullet"                      "zealous_illadopsis"</span></span></code></pre>
<p>LMDB stores keys in sorted order (not necessarily R’s sorted order -
you can see how LMDB sorts things with the <code>cmp</code> method of a
transaction - see <code><a href="../reference/mdb_txn.html">?mdb_txn</a></code>), so <code>list</code> will
return things in that order.</p>
<p>Each <em>key</em> has a <em>value</em> (in this case just a hex
string)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="va">keys</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "dd20ef9acb9228c9cb28516adbdcb8bf"</span></span></code></pre>
<p>Delete a key with</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">del</span><span class="op">(</span><span class="va">keys</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>and now there are only 9 keys</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 9</span></span></code></pre>
<p>Test for existence of a key with <code>exists</code></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">exists</span><span class="op">(</span><span class="va">keys</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">exists</span><span class="op">(</span><span class="va">keys</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>The <code>mget</code> method will get multiple keys at once,
<code>mset</code> will set multiple key/value pairs at once and
<code>mdel</code> will delete multiple keys at once.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">mdel</span><span class="op">(</span><span class="va">keys</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE</span></span></code></pre>
<p>For anything more complicated than this you would want to use
transactions (see below).</p>
<p>The <code>Informational</code> methods all return information about
the state of the LMDB environment;</p>
<p>The path that the data is stored in</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">path</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/tmp/RtmpR8CpP6/file1da451b81dd7"</span></span></code></pre>
<p>which will contain two files - the actual data and a lock file (see
lmdb’s documentation for more on these).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="fu">path</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "data.mdb" "lock.mdb"</span></span></code></pre>
<p>Flags that the environment was opened with (this corresponds to the
arguments to the <code><a href="../reference/mdb_env.html">thor::mdb_env</a></code> function)</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">flags</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   subdir readonly writemap metasync     sync mapasync     lock  rdahead </span></span>
<span><span class="co">##     TRUE    FALSE    FALSE     TRUE     TRUE    FALSE     TRUE     TRUE </span></span>
<span><span class="co">##  meminit </span></span>
<span><span class="co">##     TRUE</span></span></code></pre>
<p>A couple of different forms of (somewhat cryptic) information about
the state of the environment</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    mapsize  last_pgno last_txnid maxreaders numreaders </span></span>
<span><span class="co">##    1048576          7         12        126          1</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">stat</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          psize          depth   branch_pages     leaf_pages overflow_pages </span></span>
<span><span class="co">##           4096              0              0              0              0 </span></span>
<span><span class="co">##        entries </span></span>
<span><span class="co">##              0</span></span></code></pre>
<p>(Note <code>entries</code> in <code>env$stat()</code> is the number
of keys in the database)</p>
</div>
<div class="section level2">
<h2 id="transactions">Transactions<a class="anchor" aria-label="anchor" href="#transactions"></a>
</h2>
<p>LMDB is <em>transactional</em>; everything that happens to the
database, read or write, happens as a transaction. For a write
transaction either the whole transaction happens or none of it happens.
For both read and write transactions, the “view” of the database is
consistent from the beginning to the end of a transaction. So if you
have a read transaction and while it is doing things a write transaction
writes to the database, the read transaction does not “see” these
changes. You can only have one write transaction at once, but as many
read transactions as you’d like.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span> <span class="op">&lt;-</span> <span class="va">env</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span>write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>As for <code>mdb_env</code>, the transaction object prints methods
grouped by theme</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;mdb_txn&gt;</span></span>
<span><span class="co">##   Informational:</span></span>
<span><span class="co">##     id()</span></span>
<span><span class="co">##     stat()</span></span>
<span><span class="co">##   Finish:</span></span>
<span><span class="co">##     commit()</span></span>
<span><span class="co">##     abort(cache = TRUE)</span></span>
<span><span class="co">##   Cursors:</span></span>
<span><span class="co">##     cursor()</span></span>
<span><span class="co">##   Data:</span></span>
<span><span class="co">##     get(key, missing_is_error = TRUE, as_proxy = FALSE, as_r ...</span></span>
<span><span class="co">##     put(key, value, overwrite = TRUE, append = FALSE)</span></span>
<span><span class="co">##     del(key)</span></span>
<span><span class="co">##     exists(key)</span></span>
<span><span class="co">##     list(starts_with = NULL, as_raw = FALSE, size = NULL)</span></span>
<span><span class="co">##     mget(key, as_proxy = FALSE, as_raw = NULL)</span></span>
<span><span class="co">##     mput(key, value, overwrite = TRUE, append = FALSE)</span></span>
<span><span class="co">##     mdel(key)</span></span>
<span><span class="co">##     replace(key, value, as_raw = NULL)</span></span>
<span><span class="co">##     pop(key, as_raw = NULL)</span></span>
<span><span class="co">##   Compare:</span></span>
<span><span class="co">##     cmp(a, b)</span></span></code></pre>
<div class="section level3">
<h3 id="simple-operations-put-get-del-etc">Simple operations (put, get, del, etc)<a class="anchor" aria-label="anchor" href="#simple-operations-put-get-del-etc"></a>
</h3>
<p>To insert data into the database, use the <code>put</code> method</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">put</span><span class="op">(</span><span class="st">"key"</span>, <span class="st">"value"</span><span class="op">)</span></span></code></pre></div>
<p>…to get it back out again, use the <code>get</code> method</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"key"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "value"</span></span></code></pre>
<p>…to delete it, use the <code>del</code> method, which returns
<code>TRUE</code> if the object was deleted and <code>FALSE</code> if
not</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">del</span><span class="op">(</span><span class="st">"key"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">del</span><span class="op">(</span><span class="st">"key"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<p>To test if an key exists or not, use the <code>exists</code> method
(which uses a cursor internally - see below)</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">exists</span><span class="op">(</span><span class="st">"key"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<p>The helper functions <code>mget</code>, <code>mput</code> and
<code>mdel</code> functions do <code>get</code> / <code>put</code> and
<code>del</code> to multiple keys at once, more efficiently than looping
in R:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu">ids</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ids/man/sentence.html" class="external-link">sentence</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">keys</span><span class="op">)</span>, style <span class="op">=</span> <span class="st">"sentence"</span><span class="op">)</span></span>
<span><span class="va">txn</span><span class="op">$</span><span class="fu">mput</span><span class="op">(</span><span class="va">keys</span>, <span class="va">values</span><span class="op">)</span></span></code></pre></div>
<p>To list keys, use <code>list</code></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "careful_gaur"                    "necessary_hen"                  </span></span>
<span><span class="co">##  [3] "preagricultural_icterinewarbler" "rhombohedral_walrus"            </span></span>
<span><span class="co">##  [5] "uninspirable_muntjac"            "unterrestrial_oryx"             </span></span>
<span><span class="co">##  [7] "upstanding_vixen"                "waiting_xiaosaurus"             </span></span>
<span><span class="co">##  [9] "wet_pullet"                      "zealous_illadopsis"</span></span></code></pre>
<p>And to fetch multiple values (<code>as_raw</code> is explained
below)</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">mget</span><span class="op">(</span><span class="va">keys</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, as_raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "21 upbeat walruses assembling madly"  </span></span>
<span><span class="co">## [2] "4 eager lizards spurting purposefully"</span></span>
<span><span class="co">## [3] "7 unkempt weasels hobbling youthfully"</span></span></code></pre>
<p>Or delete multiple values</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">mdel</span><span class="op">(</span><span class="va">keys</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE TRUE TRUE</span></span></code></pre>
<p><code>exists</code> is itself always vectorised</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">exists</span><span class="op">(</span><span class="va">keys</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE</span></span></code></pre>
<p>Because the database is transactional, we can now either use
<code>txn$commit()</code> to save the changes or
<code>txn$abort()</code> to discard the changes.</p>
</div>
<div class="section level3">
<h3 id="multiple-transactions-at-once">Multiple transactions at once<a class="anchor" aria-label="anchor" href="#multiple-transactions-at-once"></a>
</h3>
<p>As well as being able to roll back a transaction, the other function
they serve is that each transaction gets a consistent view of the
database. At this point we have one write transaction running, but it’s
not committed yet. So if we start another transaction, it will not see
any of the uncommitted “changes” that our transaction has made:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn_new</span> <span class="op">&lt;-</span> <span class="va">env</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">txn_new</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## character(0)</span></span></code></pre>
<p>(or equivalently, <code>env$list()</code>). Because of the design of
LMDB, you cannot have multiple active write transactions at once</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">put</span><span class="op">(</span><span class="st">"key"</span>, <span class="st">"value"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in self$.check_write(): Write transaction is already active for this environment</span></span></code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span>write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in self$.check_write(): Write transaction is already active for this environment</span></span></code></pre>
<p>(if a write transaction is made by another process against the same
LMDB database, then it will wait for our transaction to complete before
its write transaction will start - this will cause R to be unresponsive
during this time)</p>
<p>Let’s commit the changes made:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">commit</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>After being committed a transaction cannot be reused:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in mdb_cursor_open(self$.ptr, self$.db$.ptr): txn has been cleaned up; can't use!</span></span></code></pre>
<p>New transactions can now see the changes</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "rhombohedral_walrus"  "uninspirable_muntjac" "unterrestrial_oryx"  </span></span>
<span><span class="co">## [4] "upstanding_vixen"     "waiting_xiaosaurus"   "wet_pullet"          </span></span>
<span><span class="co">## [7] "zealous_illadopsis"</span></span></code></pre>
<p>But importantly <em>old ones can’t</em></p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn_new</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## character(0)</span></span></code></pre>
<p>This is because the old transaction has a consistent view of the
database - from the point that it starts to the point that it ends, a
read-only transaction will see the same data and a read-write
transaction will only see changes that it has made.</p>
<p>(cleaning things up a little)</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn_new</span><span class="op">$</span><span class="fu">abort</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">env</span><span class="op">$</span><span class="fu">mdel</span><span class="op">(</span><span class="va">keys</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="non-string-data">Non-string data<a class="anchor" aria-label="anchor" href="#non-string-data"></a>
</h3>
<p>thor (and LMDB) can handle two types of data; strings (as above) and
raw vectors. Raw vectors can be used to serialise R objects using
<code>serialize</code>, which allows storing of arbitrary data. This is
the approach taken by <a href="https://cran.r-project.org/package=redux" class="external-link"><code>redux</code></a>
among other packages.</p>
<p>All strings can be represented in raw vectors but the reverse is not
true; character strings may not contain the null byte and the resulting
string may not make sense. thor uses the presence of a null byte as a
heuristic when it needs to test if a value is raw or not.</p>
<p>So the string “hello” can be converted to raw:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html" class="external-link">charToRaw</a></span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 68 65 6c 6c 6f</span></span></code></pre>
<p>But the set of bytes <code>2a 00 ff</code> cannot be:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html" class="external-link">rawToChar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/raw.html" class="external-link">as.raw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">0</span>, <span class="fl">255</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in rawToChar(as.raw(c(42, 0, 255))): embedded nul in string: '*\0\xff'</span></span></code></pre>
<p>This poses some problems for specifying and predicting return types,
which will be explored below. thor tries hard to set the return type
predictably; a few boolean arguments to the function determine the type
rather than the contents of the data.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span> <span class="op">&lt;-</span> <span class="va">env</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span>write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>First, this is why one might want to store raw data in a database.
Suppose we want to store the contents of <code>mtcars</code> as a value.
It’s not a string so we can’t do</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">put</span><span class="op">(</span><span class="st">"mtcars"</span>, <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in mdb_put(self$.ptr, self$.db$.ptr, key, value, overwrite, append): Invalid data type for 'value'; expected string or raw</span></span></code></pre>
<p>First we should <em>serialise</em> it to raw:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars_ser</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">serialize</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>which creates a fairly long string of bytes</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mtcars_ser</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  raw [1:3807] 58 0a 00 00 ...</span></span></code></pre>
<p>converting back from this to an R object is easy with
<code>unserialize</code></p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">unserialize</a></span><span class="op">(</span><span class="va">mtcars_ser</span><span class="op">)</span>, <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">put</span><span class="op">(</span><span class="st">"mtcars"</span>, <span class="va">mtcars_ser</span><span class="op">)</span></span>
<span><span class="va">txn</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "mtcars"</span></span></code></pre>
<p>When fetching the data, thor will work out that this is raw data and
return a raw vector:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">txn</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "raw"</span></span></code></pre>
<p>So we can now store and retrieve arbitrary R objects into the
database.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/serialize.html" class="external-link">unserialize</a></span><span class="op">(</span><span class="va">txn</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span><span class="op">)</span>, <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">del</span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>Automatic type detection is a mixed blessing (like pitfalls with
<code>sapply</code>) and thor provides mechanisms for taming it.</p>
<p>Here are two values as raw vectors - one that can be converted to a
string and one that can’t</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bytes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/raw.html" class="external-link">as.raw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">0</span>, <span class="fl">255</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">string</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html" class="external-link">charToRaw</a></span><span class="op">(</span><span class="st">"hello!"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">txn</span><span class="op">$</span><span class="fu">put</span><span class="op">(</span><span class="st">"bytes"</span>, <span class="va">bytes</span><span class="op">)</span></span>
<span><span class="va">txn</span><span class="op">$</span><span class="fu">put</span><span class="op">(</span><span class="st">"string"</span>, <span class="va">string</span><span class="op">)</span></span></code></pre></div>
<p>The value of the return type is determined both by the value of the
object and by the value of the argument <code>as_raw</code>.</p>
<table class="table">
<thead><tr class="header">
<th>stored</th>
<th><code>as_raw</code></th>
<th>result</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>string</td>
<td><code>NULL</code></td>
<td>character</td>
</tr>
<tr class="even">
<td>string</td>
<td><code>FALSE</code></td>
<td>character</td>
</tr>
<tr class="odd">
<td>string</td>
<td><code>TRUE</code></td>
<td>raw</td>
</tr>
<tr class="even">
<td>bytes</td>
<td><code>NULL</code></td>
<td>character</td>
</tr>
<tr class="odd">
<td>bytes</td>
<td><code>FALSE</code></td>
<td>error</td>
</tr>
<tr class="even">
<td>bytes</td>
<td><code>TRUE</code></td>
<td>raw</td>
</tr>
</tbody>
</table>
<p>for example</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"string"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "hello!"</span></span></code></pre>
<p>is character because <code>as_raw</code> is <code>NULL</code> and the
value <em>can</em> be represented as a string, while</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"bytes"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2a 00 ff</span></span></code></pre>
<p>is raw because the value cannot be represented as a string.
Specifying <code>as_raw = TRUE</code> will <em>always</em> return raw
because everything can be represented as raw. And specifying
<code>as_raw = FALSE</code> will throw an error for a value that cannot
be converted into a string.</p>
<p>For <code>mget</code>, it’s a bit trickier because we need to check
<em>every</em> value as they come out to see if it’s a string or a
character. The rules here are:</p>
<table class="table">
<thead><tr class="header">
<th>stored</th>
<th><code>as_raw</code></th>
<th>container</th>
<th>contents</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>string</td>
<td><code>NULL</code></td>
<td>list</td>
<td>character</td>
</tr>
<tr class="even">
<td>string</td>
<td><code>FALSE</code></td>
<td>character</td>
<td>(character)</td>
</tr>
<tr class="odd">
<td>string</td>
<td><code>TRUE</code></td>
<td>list</td>
<td>raw</td>
</tr>
<tr class="even">
<td>bytes</td>
<td><code>NULL</code></td>
<td>list</td>
<td>raw</td>
</tr>
<tr class="odd">
<td>bytes</td>
<td><code>FALSE</code></td>
<td>error</td>
<td>(error)</td>
</tr>
<tr class="even">
<td>bytes</td>
<td><code>TRUE</code></td>
<td>list</td>
<td>raw</td>
</tr>
<tr class="odd">
<td>mixed</td>
<td><code>NULL</code></td>
<td>list</td>
<td>mixed</td>
</tr>
<tr class="even">
<td>mixed</td>
<td><code>FALSE</code></td>
<td>error</td>
<td>(error)</td>
</tr>
<tr class="odd">
<td>mixed</td>
<td><code>NULL</code></td>
<td>list</td>
<td>raw</td>
</tr>
</tbody>
</table>
<p>That is, if <code>as_raw = FALSE</code> we return a character or
error if this is not possible, otherwise (<code>as_raw = TRUE</code>,
<code>as_raw = NULL</code>) we always return a list. This should make
programming with because the value of <code>as_raw</code> entirely
predicts the container type. Within the container, the rule for contents
is the same as for <code><a href="https://rdrr.io/r/base/get.html" class="external-link">get()</a></code>.</p>
<p>So, the default (<code>as_raw = NULL</code>) returns a list with
auto-detected types for each element:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">mget</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"string"</span>, <span class="st">"bytes"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] "hello!"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] 2a 00 ff</span></span></code></pre>
<p>Or we could get both as raw</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">mget</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"string"</span>, <span class="st">"bytes"</span><span class="op">)</span>, as_raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] 68 65 6c 6c 6f 21</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] 2a 00 ff</span></span></code></pre>
<p>But because one of the values is binary, we can’t do this:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">mget</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"string"</span>, <span class="st">"bytes"</span><span class="op">)</span>, as_raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in thor_mget(self$.ptr, self$.db$.ptr, key, as_proxy, as_raw): value contains embedded nul bytes; cannot return string</span></span></code></pre>
<p>But if we only pull strings it’s ok:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">mget</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"string"</span>, <span class="st">"string"</span><span class="op">)</span>, as_raw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "hello!" "hello!"</span></span></code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txn</span><span class="op">$</span><span class="fu">abort</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="caveats">Caveats<a class="anchor" aria-label="anchor" href="#caveats"></a>
</h2>
<p>LMDB will allow multiple process to access the database at the same
time, but enforce only one write transaction. <strong>However</strong>
to make that work relies on file locking. The LMDB documentation covers
issues around more detail - all the issues there apply to
<code>thor</code>, though some of them are ensured by the thor’s design
(and because R is single threaded some do not really affect us).</p>
<ul>
<li><p>crashed processes may leave stale lockfiles that may need to be
removed by <code>reader_check()</code></p></li>
<li><p>do not use LMDB database on remote systems, even between
processes on the same host, as file locking and memory map sync may be
unreliable. This may be disappointing, but if you have multiple hosts
you really do need a server based solution, not a file based
one.</p></li>
<li><p>avoid long-lived transactions, as they can cause the database
size to grow quickly.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Howard Chu, Martin Hedenfalk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
